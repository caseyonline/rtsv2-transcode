%% -*- mode:erlang;tab-width:2;erlang-indent-level:2;indent-tabs-mode:nil -*-
[ {rtsv2,
   [ {web_port, 3001}
   , {agents
     , [ <<"EdgeAgent">>
       , <<"IngestAgent">>
       , <<"StreamRelayAgent">>
       , <<"IntraPoPAgent">>
       , <<"TransPoPAgent">>
       ]}
   ]}

, {kernel,
   [ {logger_level, debug}
   , {logger, [
               %% debug.log
               {handler, disk_log, logger_std_h,
                #{config => #{
                              file => "logs/3001/debug.log",
                              max_no_files => 10,
                              max_no_bytes => 22428800 % 10 x 5mb
                             },
                  level => debug,
                  formatter => {logger_formatter, #{single_line => true,
                                                    time_offset => "Z",
                                                    chars_limit => 4096,
                                                    depth => 40,
                                                    template => [time," ", level,": ", pid, " ", mfa, ":", line, " ", msg, ": ", misc, "domain: ", domain, "\n"]
                                                   }
                               },
                  filters => [
                             ]
                 }
               },

               %% intraPop.log
               {handler, intraPop_log, logger_std_h,
                #{config => #{
                              file => "logs/3001/intraPop.log",
                              max_no_files => 10,
                              max_no_bytes => 22428800 % 10 x 5mb
                             },
                  level => debug,
                  formatter => {logger_formatter, #{single_line => true,
                                                    time_offset => "Z",
                                                    chars_limit => 4096,
                                                    depth => 40,
                                                    template => [time," ", level,": ", pid, " ", mfa, ":", line, " ", msg, ": ", misc, "domain: ", domain, "\n"]
                                                   }
                               },
                  filter_default => stop,
                  filters => [
                              {domain_filter, {fun logger_filters:domain/2, {log, sub, ['IntraPoPAgent']}}}
                             ]
                 }
               },

               %% Console
               { handler, default, logger_std_h
               , #{ formatter => { logger_formatter
                                 , #{ single_line => true
                                    , time_offset => "Z"
                                    , chars_limit => 32768
                                    , depth => 40
                                    , template => [time," ", level,": ", pid, " ", msg, ": ", misc, "\n"]
                                    }}
                  , filters => [
                               ]
                  }
               }
              ]}
   ]}
].
